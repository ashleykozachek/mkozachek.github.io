<meta name="Kana Tester" http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<meta name="version" content="Alpha">
<meta name="author" content="Matthew Kozachek">
<meta name="email" content="mkozachek@gmail.com">
<meta name="github" content="www.github.com/mkozachek">
<html>
<body style="font-size: 500%">
<div id="kanaDiv" align="center"></div>
<div id="textDiv" align="center"></div>
<script type="text/javascript" charset="UTF-8">
    var randomValue = 10;
    var correctnessValue = 3;
    var occurrenceCost = 2;
    var A = 65;
    var Z = 90;
    var BACKSPACE = 8;
    var ENTER = 13;
    
    var hiraganaMap = new Map([["\u3042",["a",0,0]],["\u3044",["i",0,0]],["\u3046",["u",0,0]],["\u3048",["e",0,0]],["\u304a",["o",0,0]],
                            ["\u304b",["ka",0,0]],["\u304d",["ki",0,0]],["\u304f",["ku",0,0]],["\u3051",["ke",0,0]],["\u3053",["ko",0,0]],
                            ["\u3055",["sa",0,0]],["\u3057",[["shi","si"],0,0]],["\u3059",["su",0,0]],["\u305b",["se",0,0]],["\u305d",["so",0,0]],
                            ["\u305f",["ta",0,0]],["\u3061",[["ti","chi"],0,0]],["\u3064",[["tsu","tu"],0,0]],["\u3066",["te",0,0]],["\u3068",["to",0,0]],
                            ["\u306a",["na",0,0]],["\u306b",["ni",0,0]],["\u306c",["nu",0,0]],["\u306d",["ne",0,0]],["\u306e",["no",0,0]],
                            ["\u306f",["ha",0,0]],["\u3072",["hi",0,0]],["\u3075",[["hu","fu"],0,0]],["\u3078",["he",0,0]],["\u307b",["ho",0,0]],
                            ["\u307e",["ma",0,0]],["\u307f",["mi",0,0]],["\u3080",["mu",0,0]],["\u3081",["me",0,0]],["\u3082",["mo",0,0]],
                            ["\u3084",["ya",0,0]],["\u3086",["yu",0,0]],["\u3088",["yo",0,0]],
                            ["\u3089",["ra",0,0]],["\u308a",["ri",0,0]],["\u308b",["ru",0,0]],["\u308c",["re",0,0]],["\u308d",["ro",0,0]],
                            ["\u308f",["wa",0,0]],["\u3090",["wi",0,0]],["\u3091",["we",0,0]],["\u3092",["wo",0,0]],
                            ["\u3093",["n",0,0]]]);
    /*var hiraganaWithModMap = new Map();
    var katakanaMap = new Map();
    var katakanaWithModMap = new Map();
    var fullKanas = new Map();*/
    
        
    function kanaMapSemiSort(kanaMap){
        var toRet = new Array();
        for (var [unicode,[_,numCorrect,occurrences]] of kanaMap[Symbol.iterator]()){
            if (numCorrect === 0){ toRet.push([unicode, Math.random()*randomValue - occurrences * occurrenceCost]); }
            else { toRet.push([unicode, Math.random()*randomValue + (occurrences/numCorrect) * correctnessValue - occurrences * occurrenceCost]); }
        }
        return toRet.sort(kanaSort);
    }
    
    function kanaSort(a, b){
        if (a[1] === b[1]){ return 0; }
        else { return (a[1] < b[1]) ? -1 : 1; }
    }
    
    var Game = {
        kanaDiv: document.getElementById("kanaDiv"),
        textDiv: document.getElementById("textDiv"),
        currentIteration: 0,
        listHalfLen: 0,
        kanaList: {},
        currentKana: "",
        
        init: function(){
            this.kanaList = kanaMapSemiSort(hiraganaMap); //hardcode this for now but add choice later when it's made all pretty-like and stuff.
            this.listHalfLen = this.kanaList.length / 2;
            this.currentKana = this.kanaList[0][0];
            this.kanaDiv.textContent = this.currentKana;
            this.textDiv.textContent = "";
        },
        
        reset: function(){
            this.kanaList = kanaMapSemiSort(hiraganaMap); //hardcode this for now but add choice later when it's made all pretty-like and stuff.
            this.currentIteration = 0;
            this.currentKana = this.kanaList[0][0];
            this.kanaDiv.textContent = this.currentKana;
        },
        
        onKeydown: function(event){
            var keyCode = event.keyCode;
            var text = this.textDiv.textContent;
            if (keyCode === BACKSPACE){
                event.preventDefault();
                if (text.length > 0){ this.textDiv.textContent = text.slice(0,-1); }
            }
            else if (keyCode >= A && keyCode <= Z){
                this.textDiv.textContent = text.concat(String.fromCharCode(keyCode)); }
            else if (keyCode === ENTER && text.length > 0) { 
                this.checkAnswer();
                this.currentIteration = this.currentIteration + 1;
                this.checkIteration();
                this.textDiv.textContent = "";
            }
        },
        
        checkAnswer: function(){
            var value = hiraganaMap.get(this.kanaDiv.textContent);
            if (typeof value[0] === 'string'){
                if (value[0] === this.textDiv.textContent.toLowerCase()){
                    value[1] = value[1] + 1;
                    value[2] = value[2] + 1;
                    alert("YAY");
                }
                else {
                    value[2] = value[2] + 1;
                    alert("BOO");
                }
            }
            else {
                for (let i = 0; i < value[0].length; i++){
                    let word = value[0][i];
                    if (word === this.textDiv.textContent.toLowerCase()){
                        value[1] = value[1] + 1;
                        value[2] = value[2] + 1;
                        alert("YAY")
                        return;
                    }
                }
                value[2] = value[2] + 1;
                alert("BOO");
            }
        },
        
        checkIteration: function(){
            if (this.currentIteration >= this.listHalfLen){
                this.reset();
            }
            else {
                this.kanaDiv.textContent = this.kanaList[this.currentIteration][0];
            }
        }
    };
    window.addEventListener('keydown', function(event) { Game.onKeydown(event); }, false);
    Game.init();
</script>
</body>
</html>
